openJiuwen框架支持多维度提示词智能优化方法。在智能对话系统中，提示词的质量直接影响大模型输出结果的准确性、相关性与稳定性。为系统性提升提示词效能，openJiuwen提供一套循序渐进的提示词优化机制，涵盖以下三个核心环节：

* 生成提示词：基于用户的原始提示词，自动生成结构化、语义清晰的提示词。实现从“模糊意图”到“结构化指令”的转化。
* 基于反馈优化提示词：基于用户提供的反馈，对原始提示词进行定向优化，提升提示词质量。
* 基于错误案例优化提示词：基于典型错误用例生成针对性改进策略，对原始提示词进行针对性优化，提升模型在边缘场景的表现。

# 生成提示词

提示词生成模块旨在将用户的初始输入转化为结构化的提示词框架。该模块通过调用大语言模型，将简单的原始输入（例如"你是一个人名提取助手"）扩展为结构清晰的包含明确角色定义、任务目标和输出规范的完整提示词，从而降低提示词编写门槛，提供标准化的起始模板，打破“不知道怎么写”的启动障碍。

通过`MetaTemplateBuilder.build`函数生成初始提示词

```python
import os

from openjiuwen.core.utils.llm.base import BaseModelInfo
from openjiuwen.core.component.common.configs.model_config import ModelConfig
from openjiuwen.agent_builder.prompt_builder.builder.meta_template_builder import MetaTemplateBuilder

API_BASE = os.getenv("API_BASE", "https://api.openai.com/v1")
API_KEY = os.getenv("API_KEY", "sk-fake")
MODEL_NAME = os.getenv("MODEL_NAME", "")
MODEL_PROVIDER = os.getenv("MODEL_PROVIDER", "")

# 1. 创建模型配置
model_info = BaseModelInfo(
    api_key=API_KEY,    # 替换为实际的API密钥
    api_base=API_BASE,  # API地址
    model=MODEL_NAME    # 模型名称
)
config = ModelConfig(model_provider=MODEL_PROVIDER, model_info=model_info)

# 2. 创建MetaTemplateBuilder对象
builder = MetaTemplateBuilder(config)

# 3. 执行提示词生成
response = builder.build(prompt="你是一个人名信息提取助手")
print(response)
```
预期返回
```text
## 人设
你是一个人名信息提取助手  
你的专业技能包括：  
- 从文本中准确识别和提取人名  
- 区分真实姓名与昵称、职位、头衔等  
- 支持多种语言的人名识别（如中文、英文等）  
- 识别并处理复杂语境中的人名信息  

## 任务描述
你的任务是从用户提供的文本中提取出所有出现的人名信息，并以清晰的方式呈现出来。这将帮助用户快速获取文本中涉及的人员信息，便于后续分析或整理。  

## 约束条件
1. 按照<输出格式>输出  
2. 按照<执行步骤>一步一步执行  
3. 仅提取明确的人名，不包括职位、头衔、公司名等  
4. 如果文本中没有可提取的人名，输出“未发现人名信息”  

## 执行步骤
1. 通读用户提供的文本，理解整体语境  
2. 识别文本中所有可能的人名，包括中文、英文等  
3. 排除非人名信息（如职位、公司名、昵称等）  
4. 按照<输出格式>整理并输出提取结果  

## 输出格式
- 输出一个无序列表，每个条目为一个提取出的人名  
- 人名使用中文或英文原样呈现，不进行翻译或修改  
- 示例格式：  
  - 张三  
  - John Smith
```

# 基于反馈优化提示词

初始生成的提示词往往无法完全满足实际应用需求。反馈优化模块通过收集用户反馈和测试结果，对提示词进行迭代改进。

通过`FeedbackPromptBuilder.build`函数进行提示词反馈优化

```python
import os

from openjiuwen.core.utils.llm.base import BaseModelInfo
from openjiuwen.core.component.common.configs.model_config import ModelConfig
from openjiuwen.agent_builder.prompt_builder.builder.feedback_prompt_builder import FeedbackPromptBuilder

API_BASE = os.getenv("API_BASE", "https://api.openai.com/v1")
API_KEY = os.getenv("API_KEY", "sk-fake")
MODEL_NAME = os.getenv("MODEL_NAME", "")
MODEL_PROVIDER = os.getenv("MODEL_PROVIDER", "")
os.environ.setdefault("LLM_SSL_VERIFY", "false")

# 1. 创建模型配置
model_info = BaseModelInfo(
    api_key=API_KEY,    # 替换为实际的API密钥
    api_base=API_BASE,  # API地址
    model=MODEL_NAME    # 模型名称
)
config = ModelConfig(model_provider=MODEL_PROVIDER, model_info=model_info)

# 2. 创建MetaTemplateBuilder对象
feedback_builder = FeedbackPromptBuilder(config)
# 上一步生成的提示词
prompt= '''## 人设定义你将扮演的角色或身份：人名提取助手列举角色的...'''
# 3. 执行提示词生成
response = feedback_builder.build(prompt=prompt, feedback="不要提取真实历史中不存在的人物")
print(response)
```
预期返回
```text
## 人设定义你将扮演的角色或身份：人名提取助手，仅列举真实存在的人物角色...
```

# 基于错误案例优化提示词

错误案例优化模块专注于处理边界情况和异常场景。通过分析失败案例，识别提示词的薄弱环节并进行针对性改进。

通过`BadCasePromptBuilder.build`函数执行提示词错误案例优化

```python
import os

from openjiuwen.core.utils.llm.base import BaseModelInfo
from openjiuwen.core.component.common.configs.model_config import ModelConfig
from openjiuwen.agent_builder.prompt_builder.builder.badcase_prompt_builder import BadCasePromptBuilder
from openjiuwen.agent_builder.tune.base import EvaluatedCase, Case

API_BASE = os.getenv("API_BASE", "https://api.openai.com/v1")
API_KEY = os.getenv("API_KEY", "sk-fake")
MODEL_NAME = os.getenv("MODEL_NAME", "")
MODEL_PROVIDER = os.getenv("MODEL_PROVIDER", "")
os.environ.setdefault("LLM_SSL_VERIFY", "false")

# 1. 创建模型配置
model_info = BaseModelInfo(
    api_key=API_KEY,    # 替换为实际的API密钥
    api_base=API_BASE,  # API地址
    model=MODEL_NAME    # 模型名称
)
config = ModelConfig(model_provider=MODEL_PROVIDER, model_info=model_info)

# 2. 创建MetaTemplateBuilder对象
feedback_builder = BadCasePromptBuilder(config)

BAD_CASES = [
    EvaluatedCase(case=Case(
        inputs={"query": "潘之恒（约1536—1621）字景升，号鸾啸生，冰华生，安徽歙县、岩寺人，侨寓金陵（今江苏南京）"},
        label={"label": "[潘之恒]"}),
        answer={"answer": "[潘之恒, 冰华生]"}
    ),
    EvaluatedCase(case=Case(
        inputs={"query": "郭造卿（1532—1593），字建初，号海岳，福建福清县化南里人（今福清市人），郭遇卿之弟，郭造卿少年的时候就很有名气，曾游学吴越"},
        label={"label": "[郭造卿, 郭遇卿]"}),
        answer={"answer": "[郭造卿, 郭遇卿, 吴越]"}
    ),
]
# 3. 执行提示词生成
response = feedback_builder.build(prompt="你是一个专业的人名信息提取助手", cases=BAD_CASES)
print(response)
```
预期结果
```text
你是一个专业的人名信息提取助手。请从文本中提取所有真实人物的本名，并以列表形式返回。人名指的是真实存在的个人的正式姓名，不包括别号、笔名、地名、地区名、组织名或其他非人名实体。请确保只提取明确指代真实人物的本名。
```
