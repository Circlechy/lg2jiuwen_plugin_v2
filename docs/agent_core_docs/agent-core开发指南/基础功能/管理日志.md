openJiuwen日志系统是一个灵活、可扩展的日志管理框架，支持多种日志器实现和配置方式。系统采用分层架构设计，将核心接口与具体实现分离，提供了统一的日志管理接口。支持如下功能：

* 默认日志器：开发者可以直接导入使用，用于开发中的日志打印记录。
* 自定义日志器：开发者可以根据需求自定义日志器，支持对日志输出进行自定义配置，包括输出格式、输出方式、文件轮转数量、单个日志文件最大大小等。

# 默认日志器

openJiuwen提供的默认日志器是对Python logging标准库的一层封装，可以直接导入openJiuwen `logger`模块使用，具体使用方式可参考Python的[logging](https://docs.python.org/3.13/library/logging.html#)标准库文档。

```python
from openjiuwen.core.common.logging import logger

logger.info(f"记录信息级别日志")
```

样例输出：

```text
2025-09-29 03:04:20 | common | test.py | 3 | <module> |  | INFO | 记录信息级别日志
```

# 自定义日志器

openJiuwen提供了`LoggerProtocol`类，用于自定义日志器；同时提供`LogManager`类，负责对自定义日志器进行注册与使用管理，保证自定义日志器的线程安全。

## 实现自定义日志器

开发者可通过继承`LoggerProtocol`类来实现自定义日志器，建议使用Python标准库`logging`中的核心函数 `getLogger`创建日志器对象`_logger`，并对其进行自定义配置，例如设置输出格式、输出方式（如控制台或文件）、日志文件轮转数量、单个日志文件的最大大小等。

```python
import sys
import logging
from logging.handlers import RotatingFileHandler

from openjiuwen.core.common.logging.protocol import LoggerProtocol
from openjiuwen.core.common.logging.utils import get_log_max_bytes

class CustomLogger(LoggerProtocol):
    """自定义日志器实现"""

    def __init__(self, log_type: str, config: dict):
        self.log_type = log_type
        self.config = config
        self._logger = logging.getLogger(f"custom_{log_type}")
        self._setup_logger()

    def _setup_logger(self):
        """设置日志器"""
        # 日志等级
        level = self.config.get('level', logging.INFO)
        self._logger.setLevel(level)
        
        # 输出方式
        output = self.config.get('output', ['console'])
        log_file = self.config.get('log_file', f'output.log')
        
        # 输出格式
        formatter = logging.Formatter(
            '%(asctime)s | [CUSTOM] | %(levelname)s | %(message)s'
        )
        
        if 'console' in output:
            stream_handler = logging.StreamHandler(stream=sys.stdout)  
            stream_handler.setFormatter(formatter)
            self._logger.addHandler(stream_handler)
        
        if 'file' in output:
            # 日志文件轮转数量
            backup_count = self.config.get('backup_count', 20)
            # 单个日志文件的最大大小
            max_bytes = get_log_max_bytes(self.config.get('max_bytes', 20 * 1024 * 1024))
        
            file_handler = RotatingFileHandler(
                filename=log_file,
                maxBytes=max_bytes,
                backupCount=backup_count,
                encoding='utf-8'
            )
            file_handler.setFormatter(formatter)
            self._logger.addHandler(file_handler)
       

    # 实现 LoggerProtocol 接口的所有方法
    def debug(self, msg: str, *args, **kwargs) -> None:
        self._logger.debug(msg, *args, **kwargs)

    def info(self, msg: str, *args, **kwargs) -> None:
        self._logger.info(msg, *args, **kwargs)

    def warning(self, msg: str, *args, **kwargs) -> None:
        self._logger.warning(msg, *args, **kwargs)

    def error(self, msg: str, *args, **kwargs) -> None:
        self._logger.error(msg, *args, **kwargs)

    def critical(self, msg: str, *args, **kwargs) -> None:
        self._logger.critical(msg, *args, **kwargs)

    def exception(self, msg: str, *args, **kwargs) -> None:
        self._logger.exception(msg, *args, **kwargs)

    def log(self, level: int, msg: str, *args, **kwargs) -> None:
        self._logger.log(level, msg, *args, **kwargs)

    def setLevel(self, level: int) -> None:
        self._logger.setLevel(level)

    def addHandler(self, handler: logging.Handler) -> None:
        self._logger.addHandler(handler)

    def removeHandler(self, handler: logging.Handler) -> None:
        self._logger.removeHandler(handler)

    def addFilter(self, filter) -> None:
        self._logger.addFilter(filter)

    def removeFilter(self, filter) -> None:
        self._logger.removeFilter(filter)

    def get_config(self) -> dict:
        return self.config.copy()

    def reconfigure(self, config: dict) -> None:
        self.config = config
        self._setup_logger()
```

## 注册自定义日志器

使用`LogManager`类的`register_logger`方法，可以将自定义日志器注册到`LogManager`中，便于管理。

```python
import logging
from openjiuwen.core.common.logging import LogManager

# 创建自定义日志器
custom_config = {
    'level': logging.INFO,
    'format': 'custom_format'
}

custom_logger = CustomLogger('my_app', custom_config)

# 注册到 LogManager
LogManager.register_logger('my_app', custom_logger)
```

## 使用自定义日志器

使用`LogManager`类的`get_logger`方法，可以获取自定义日志器实例进行使用。

```python
from openjiuwen.core.common.logging import LogManager

# 使用自定义日志器
logger = LogManager.get_logger('my_app')
logger.info("这是自定义日志器的消息")
```

样例输出：

```text
2025-09-29 03:07:04,789 | [CUSTOM] | INFO | 这是自定义日志器的消息
```
